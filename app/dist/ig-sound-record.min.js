!function(a,b,c,d,e){var f,g={},h=function(b){return a.Function("return "+b)()},i=a.document,j=function(b,e){l("lmd-register:before-register",b,e);var h={exports:{}};if(g[b]=1,c[b]=h.exports,e){if("function"==typeof e){var i=l("lmd-register:decorate-require",b,n)[1];d[b]&&d[b].sandbox&&"function"==typeof i&&(i=f),e=e(i,h.exports,h)||h.exports}}else e=l("js:request-environment-module",b,e)[1]||a[b];return e=l("lmd-register:after-register",b,e)[1],c[b]=e},k={},l=function(a,b,c,d){var e,f=k[a];if(f)for(var g=0,h=f.length;h>g;g++)e=f[g](b,c,d)||e,e&&(b=e[0]||b,c=e[1]||c,d=e[2]||d);return e||[b,c,d]},m=function(a,b){k[a]||(k[a]=[]),k[a].push(b)},n=function(a){var b=c[a],d=l("*:rewrite-shortcut",a,b);return d&&(a=d[0],b=d[1]),l("*:before-check",a,b),g[a]&&b?b:(l("*:before-init",a,b),"string"==typeof b&&0===b.indexOf("(function(")&&(b=h(b)),j(a,b))},o={exports:{}},p={global:a,modules:c,modules_options:d,options:e,eval:h,register:j,require:n,initialized:g,document:i,on:m,trigger:l,undefined:f};for(var q in c)g[q]=0;!function(a){function b(a){var b=[];for(var d in a)a.hasOwnProperty(d)&&b.push(f(d)+":"+c(a[d]));return"{"+b.join(",")+"}"}function c(a){if("string"==typeof a)return f(a);if("boolean"==typeof a)return""+a;if(a.join){if(0==a.length)return"[]";for(var d=[],e=0,g=a.length;g>e;e+=1)d.push(c(a[e]));return"["+d.join(",")+"]"}return"number"==typeof a?a:b(a)}function d(a){return"0000".substr(a.length)+a}function e(a){switch(a){case"\b":return"\\b";case"\f":return"\\f";case"\n":return"\\n";case"\r":return"\\r";case"	":return"\\t";case'"':return'\\"';case"\\":return"\\\\";default:return"\\u"+d(a.charCodeAt(0).toString(16))}}function f(a){return'"'+a.replace(/[\u0000-\u001f"\\\u007f-\uffff]/g,e)+'"'}function g(a){for(var b=this.length;b-->0;)if(this[b]===a)return b;return-1}a.on("*:request-json",function(a){return"object"==typeof a?[a]:[{stringify:b}]}),a.on("*:request-indexof",function(a){return"function"==typeof a?[a]:[g]})}(p),b(l("lmd-register:decorate-require","main",n)[1],o.exports,o)}(this,function(a){window.ig={sound:{record:{Wav:a("ig/Wav")}}}},{"ig/Wav":function(a,b,c){var d={WEB:a("ig/engine/WEB"),Flash:a("ig/engine/Flash")};c.exports=the.module({Wav:{our:{engine:0,initRecordEngine:function(){this.engine||(navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia,navigator.getUserMedia?(window.AudioContext=window.AudioContext||window.webkitAudioContext,window.URL=window.URL||window.webkitURL,this.engine=d.WEB):this.engine=d.Flash)}},engine:0,Wav:function(a){return this.our.initRecordEngine(),new this.our.engine(a)}}})},"ig/engine/Flash":function(a,b,c){var d=a("jwagener/Recorder");c.exports=the.module({Flash:{our:{swfPath:"/recorder.swf"},inited:!1,Flash:function(a){a=a||function(){};var b=this;return b.our.singleton?b.our.singleton:(b.our.singleton=b,void b.init(a))},init:function(a){var b=this;d.initialize({swfSrc:b.our.swfPath,initialized:function(){d.record({start:function(){d.stop(),b.inited=!0,a()}})}})},start:function(a){this.inited?(a=a||function(){},d.record({start:function(){a()}})):a(new Error("Engine not init"))},stop:function(){d.stop()},upload:function(a,b){b=b||function(){},d.upload({url:a,success:function(a){b(a)}})}}})},"ig/engine/WEB":function(a,b,c){var d=a("mattdiamond/Recorder");c.exports=the.module({WEB:{stream:0,inited:!1,context:0,recorder:0,WEB:function(a){a=a||function(){};var b=this;b.init(a)},init:function(a){var b=this,c=b.context=new AudioContext,e=b.inputPoint=c.createGain();b.recorder=new d(e),b.start(function(c){c||(b.stop(),b.inited=!0),a(c)})},_start:function(a){var b=this.recorder;b.clear(),b.record(),a()},start:function(a){a=a||function(){};var b=this;b.getStream(function(c,d){c?a(c):(b.stream=d,b.setupStream(),b._start(a))})},stop:function(){var a=this;a.recorder.stop(),a.stream.stop()},setupStream:function(){var a,b=this,c=b.context,d=c.createMediaStreamSource(b.stream);d.connect(b.inputPoint),a=c.createGain(),a.gain.value=0,d.connect(a),a.connect(c.destination)},getStream:function(a){navigator.getUserMedia({audio:!0},function(b){a(!1,b)},function(b){a(b)})},getBuffer:function(){},upload:function(a,b){b=b||function(){};var c=this,d=new FormData,e=new XMLHttpRequest;c.recorder.stop(),c.recorder.exportWAV(function(b){d.append("audio",b,"audio.wav"),e.open("POST",a),e.send(d)}),e.onreadystatechange=function(){4==e.readyState&&(200==e.status?b(e.responseText):b())}}}})},"jwagener/Recorder":function(a,b,c){c.exports=Recorder={version:1.13,swfObject:null,_callbacks:{},_events:{},_initialized:!1,_flashBlockCatched:!1,options:{},initialize:function(a){if(this.options=a||{},"file:"===window.location.protocol)throw new Error("Due to Adobe Flash restrictions it is not possible to use the Recorder through the file:// protocol. Please use an http server.");this.options.flashContainer||this._setupFlashContainer(),this.bind("initialized",function(){Recorder._initialized=!0,Recorder._flashBlockCatched&&Recorder._defaultOnHideFlash(),a.initialized&&a.initialized()}),this.bind("showFlash",this.options.onFlashSecurity||this._defaultOnShowFlash),this._loadFlash()},clear:function(){Recorder._events={}},record:function(a){a=a||{},this.clearBindings("recordingStart"),this.clearBindings("recordingProgress"),this.clearBindings("recordingCancel"),this.bind("recordingStart",this._defaultOnHideFlash),this.bind("recordingCancel",this._defaultOnHideFlash),this.bind("recordingCancel",this._loadFlash),this.bind("recordingStart",a.start),this.bind("recordingProgress",a.progress),this.bind("recordingCancel",a.cancel),this.flashInterface().record()},stop:function(){return this.flashInterface()._stop()},play:function(a){a=a||{},this.clearBindings("playingProgress"),this.bind("playingProgress",a.progress),this.bind("playingStop",a.finished),this.flashInterface()._play()},upload:function(a){a.audioParam=a.audioParam||"audio",a.params=a.params||{},this.clearBindings("uploadSuccess"),this.bind("uploadSuccess",function(b){a.success(Recorder._externalInterfaceDecode(b))}),this.flashInterface().upload(a.url,a.audioParam,a.params)},audioData:function(a){var b,c,d,e=";",f=[];a&&(b=a.join(";")),c=this.flashInterface().audioData(b).split(e);for(var g=0;g<c.length;g++)d=parseFloat(c[g]),isNaN(d)||f.push(d);return f},request:function(a,b,c,d,e){var f=this.registerCallback(e);this.flashInterface().request(a,b,c,d,f)},clearBindings:function(a){Recorder._events[a]=[]},bind:function(a,b){Recorder._events[a]||(Recorder._events[a]=[]),Recorder._events[a].push(b)},triggerEvent:function(a,b,c){Recorder._executeInWindowContext(function(){if(Recorder._events[a])for(var d=0,e=Recorder._events[a].length;e>d;d++)Recorder._events[a][d]&&Recorder._events[a][d].apply(Recorder,[b,c])})},triggerCallback:function(a,b){Recorder._executeInWindowContext(function(){Recorder._callbacks[a].apply(null,b)})},registerCallback:function(a){var b="CB"+parseInt(999999*Math.random(),10);return Recorder._callbacks[b]=a,b},flashInterface:function(){return this.swfObject?this.swfObject.record?this.swfObject:this.swfObject.children[3].record?this.swfObject.children[3]:void 0:null},_executeInWindowContext:function(a){window.setTimeout(a,1)},_setupFlashContainer:function(){this.options.flashContainer=document.createElement("div"),this.options.flashContainer.setAttribute("id","recorderFlashContainer"),this.options.flashContainer.setAttribute("style","position: fixed; left: -9999px; top: -9999px; width: 230px; height: 140px; margin-left: 10px; border-top: 6px solid rgba(128, 128, 128, 0.6); border-bottom: 6px solid rgba(128, 128, 128, 0.6); border-radius: 5px 5px; padding-bottom: 1px; padding-right: 1px;"),document.body.appendChild(this.options.flashContainer)},_clearFlash:function(){var a=this.options.flashContainer.children[0];a&&this.options.flashContainer.removeChild(a)},_loadFlash:function(){this._clearFlash();var a=document.createElement("div");a.setAttribute("id","recorderFlashObject"),this.options.flashContainer.appendChild(a),swfobject.embedSWF(this.options.swfSrc,"recorderFlashObject","231","141","10.1.0",void 0,void 0,{allowscriptaccess:"always"},void 0,function(a){a.success?(Recorder.swfObject=a.ref,Recorder._checkForFlashBlock()):Recorder._showFlashRequiredDialog()})},_defaultOnShowFlash:function(){var a=Recorder.options.flashContainer;a.style.left=(window.innerWidth||document.body.offsetWidth)/2-115+"px",a.style.top=(window.innerHeight||document.body.offsetHeight)/2-70+"px"},_defaultOnHideFlash:function(){var a=Recorder.options.flashContainer;a.style.left="-9999px",a.style.top="-9999px"},_checkForFlashBlock:function(){window.setTimeout(function(){Recorder._initialized||(Recorder._flashBlockCatched=!0,Recorder.triggerEvent("showFlash"))},500)},_showFlashRequiredDialog:function(){Recorder.options.flashContainer.innerHTML="<p>Adobe Flash Player 10.1 or newer is required to use this feature.</p><p><a href='http://get.adobe.com/flashplayer' target='_top'>Get it on Adobe.com.</a></p>",Recorder.options.flashContainer.style.color="white",Recorder.options.flashContainer.style.backgroundColor="#777",Recorder.options.flashContainer.style.textAlign="center",Recorder.triggerEvent("showFlash")},_externalInterfaceDecode:function(a){return a.replace(/%22/g,'"').replace(/%5c/g,"\\").replace(/%26/g,"&").replace(/%25/g,"%")}}},"mattdiamond/Recorder":function(a,b,c){!function(a){var b=function(c,d){var e=d||{},f=e.bufferLen||4096;this.context=c.context,this.node=(this.context.createScriptProcessor||this.context.createJavaScriptNode).call(this.context,f,2,2),b.worker=function(){function a(a){k=a.sampleRate}function b(a){m.push(a[0]),n.push(a[1]),l+=a[0].length}function c(a){var b=f(m,l),c=f(n,l),d=g(b,c),e=j(d),h=new Blob([e],{type:a});this.postMessage(h)}function d(){var a=[];a.push(f(m,l)),a.push(f(n,l)),this.postMessage(a)}function e(){l=0,m=[],n=[]}function f(a,b){for(var c=new Float32Array(b),d=0,e=0;e<a.length;e++)c.set(a[e],d),d+=a[e].length;return c}function g(a,b){for(var c=a.length+b.length,d=new Float32Array(c),e=0,f=0;c>e;)d[e++]=a[f],d[e++]=b[f],f++;return d}function h(a,b,c){for(var d=0;d<c.length;d++,b+=2){var e=Math.max(-1,Math.min(1,c[d]));a.setInt16(b,0>e?32768*e:32767*e,!0)}}function i(a,b,c){for(var d=0;d<c.length;d++)a.setUint8(b+d,c.charCodeAt(d))}function j(a){var b=new ArrayBuffer(44+2*a.length),c=new DataView(b);return i(c,0,"RIFF"),c.setUint32(4,32+2*a.length,!0),i(c,8,"WAVE"),i(c,12,"fmt "),c.setUint32(16,16,!0),c.setUint16(20,1,!0),c.setUint16(22,2,!0),c.setUint32(24,k,!0),c.setUint32(28,4*k,!0),c.setUint16(32,4,!0),c.setUint16(34,16,!0),i(c,36,"data"),c.setUint32(40,2*a.length,!0),h(c,44,a),c}var k,l=0,m=[],n=[];this.onmessage=function(f){switch(f.data.command){case"init":a(f.data.config);break;case"record":b(f.data.buffer);break;case"exportWAV":c(f.data.type);break;case"getBuffer":d();break;case"clear":e()}}};var g=new Worker(a.URL.createObjectURL(new Blob(["("+b.worker.toString()+"())"],{type:"text/javascript"})));g.postMessage({command:"init",config:{sampleRate:this.context.sampleRate}});var h,i=!1;this.node.onaudioprocess=function(a){i&&g.postMessage({command:"record",buffer:[a.inputBuffer.getChannelData(0),a.inputBuffer.getChannelData(1)]})},this.configure=function(a){for(var b in a)a.hasOwnProperty(b)&&(e[b]=a[b])},this.record=function(){i=!0},this.stop=function(){i=!1},this.clear=function(){g.postMessage({command:"clear"})},this.getBuffer=function(a){h=a||e.callback,g.postMessage({command:"getBuffer"})},this.exportWAV=function(a,b){if(h=a||e.callback,b=b||e.type||"audio/wav",!h)throw new Error("Callback not set");g.postMessage({command:"exportWAV",type:b})},g.onmessage=function(a){var b=a.data;h(b)},c.connect(this.node),this.node.connect(this.context.destination)};b.forceDownload=function(b,c){var d=(a.URL||a.webkitURL).createObjectURL(b),e=a.document.createElement("a");e.href=d,e.download=c||"output.wav";var f=document.createEvent("Event");f.initEvent("click",!0,!0),e.dispatchEvent(f)},c.exports=b}(window)}},{},{});